<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>Lecture Feedback</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Firebase SDK (compat verze ‚Äì nejjednodu≈°≈°√≠ v jednom souboru) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- PrimeIcons (jen pro zav√≠rac√≠ ikonu v modalu, m≈Ø≈æe≈° klidnƒõ vyhodit) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/primeicons/primeicons.css">

  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --accent: #16a34a;
      --bg: #f5f5f7;
      --card-bg: #ffffff;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border: #e5e7eb;
      --radius: 14px;
      --shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .page {
      width: 100%;
      max-width: 900px;
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 18px 18px 26px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 16px;
    }

    h1 {
      margin: 0;
      font-size: 22px;
    }

    .subtitle {
      margin: 2px 0 0;
      font-size: 13px;
      color: var(--text-muted);
    }

    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }

    .btn {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      cursor: pointer;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--accent);
      color: #ffffff;
      box-shadow: 0 6px 18px rgba(22, 163, 74, 0.35);
    }

    .btn-primary:hover {
      background: #15803d;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-main);
    }

    .btn-ghost:hover {
      background: rgba(15, 23, 42, 0.06);
    }

    .date-info {
      font-size: 12px;
      color: var(--text-muted);
    }

    main {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .top-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.1fr);
      gap: 16px;
      align-items: flex-start;
    }

    @media (max-width: 768px) {
      .page {
        border-radius: 8px;
        box-shadow: none;
      }

      .top-layout {
        grid-template-columns: 1fr;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
      }

      .header-right {
        align-items: flex-start;
      }
    }

    .card {
      background: #ffffff;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 14px 16px 16px;
    }

    .card-title {
      margin: 0 0 4px;
      font-size: 16px;
      font-weight: 600;
    }

    .card-subtitle {
      margin: 0 0 10px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .qr-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .qr-box {
      background: #f9fafb;
      padding: 8px;
      border-radius: 16px;
      border: 1px solid var(--border);
    }

    .qr-box img {
      display: block;
      width: 170px;
      height: 170px;
    }

    .qr-caption {
      font-size: 12px;
      text-align: center;
      color: var(--text-muted);
      max-width: 260px;
    }

    .feedback-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .feedback-info {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .feedback-card {
      background: #f9fafb;
      border-radius: 10px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      font-size: 13px;
    }

    .feedback-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 6px;
      margin-bottom: 4px;
    }

    .feedback-name {
      font-weight: 600;
    }

    .feedback-date {
      font-size: 11px;
      color: var(--text-muted);
    }

    .feedback-ratings {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 12px;
      margin-bottom: 4px;
    }

    .feedback-ratings span {
      background: #e5e7eb;
      border-radius: 999px;
      padding: 2px 8px;
    }

    .feedback-section-label {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      margin-top: 4px;
      margin-bottom: 2px;
    }

    .feedback-text {
      margin: 0;
      white-space: pre-wrap;
    }

    .feedback-empty {
      font-size: 13px;
      color: var(--text-muted);
      text-align: center;
      padding: 12px 4px;
    }

    /* ===== MODAL ===== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.55);
      display: none;
      justify-content: center;
      align-items: center;
      padding: 16px;
      z-index: 50;
    }

    .modal-overlay.open {
      display: flex;
    }

    .modal {
      background: #ffffff;
      border-radius: 18px;
      width: 100%;
      max-width: 440px;
      padding: 18px 16px 16px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.4);
      animation: modalIn 0.18s ease-out;
    }

    @keyframes modalIn {
      from {
        opacity: 0;
        transform: translateY(8px) scale(0.98);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .modal-title {
      margin: 0;
      font-size: 17px;
      font-weight: 600;
    }

    .modal-close {
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 18px;
      color: var(--text-muted);
      padding: 4px;
      border-radius: 999px;
    }

    .modal-close:hover {
      background: #f3f4f6;
    }

    .form-group {
      margin-bottom: 10px;
    }

    .form-label {
      display: block;
      margin-bottom: 4px;
      font-size: 13px;
      font-weight: 600;
    }

    .form-helper {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    select,
    input[type="text"],
    textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 9px;
      border: 1px solid var(--border);
      font-size: 14px;
      font-family: inherit;
      outline: none;
      background: #ffffff;
      transition: border-color 0.15s, box-shadow 0.15s, background 0.15s;
    }

    select:focus,
    input[type="text"]:focus,
    textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.25);
    }

    textarea {
      resize: vertical;
      min-height: 70px;
    }

    .rating-row {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .rating-select {
      flex: 0 0 130px;
    }

    .buttons-row {
      display: flex;
      gap: 10px;
      margin-top: 14px;
    }

    .btn-secondary {
      flex: 1;
      background: #f3f4f6;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      color: var(--text-main);
      font-weight: 500;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 14px;
    }

    .btn-secondary:hover {
      background: #e5e7eb;
    }

    .btn-primary-wide {
      flex: 1.4;
      padding: 9px 12px;
      border-radius: 999px;
      border: none;
      background: var(--primary);
      color: #ffffff;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.35);
    }

    .btn-primary-wide:hover {
      background: var(--primary-dark);
    }

    .status {
      margin-top: 8px;
      font-size: 12px;
      text-align: center;
      display: none;
    }

    .status.ok {
      display: block;
      color: #16a34a;
    }

    .status.error {
      display: block;
      color: #b91c1c;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div>
        <h1>Lecture Feedback</h1>
        <p class="subtitle">
          QR k√≥d naho≈ôe ‚Üí otev≈ôe ‚ÄûNov√Ω feedback‚Äú. V≈°echny odpovƒõdi vid√≠≈° n√≠≈æe.
        </p>
      </div>
      <div class="header-right">
        <button class="btn btn-ghost" id="openFeedbackBtn">
          <i class="pi pi-plus"></i>
          Nov√Ω feedback
        </button>
        <div class="date-info" id="todayInfo"></div>
      </div>
    </header>

    <main>
      <div class="top-layout">
        <!-- QR ƒç√°st -->
        <section class="card">
          <h2 class="card-title">QR k√≥d na feedback</h2>
          <p class="card-subtitle">
            Tento QR k√≥d odkazuje na tuto str√°nku s parametrem <code>?new=1</code>, tak≈æe se lidem rovnou otev≈ôe modal ‚ÄûNew feedback‚Äú.
          </p>

          <div class="qr-wrapper">
            <div class="qr-box">
              <img id="qrImage" alt="QR k√≥d na nov√Ω feedback">
            </div>
            <div class="qr-caption">
              Vlo≈æ tento QR k√≥d do slajd≈Ø / materi√°l≈Ø.  
              Lid√© otev≈ôou str√°nku a hned uvid√≠ formul√°≈ô pro feedback.
            </div>
          </div>
        </section>

        <!-- Info ƒç√°st -->
        <section class="card">
          <h2 class="card-title">Co se sb√≠r√°</h2>
          <p class="card-subtitle">
            Ka≈æd√Ω feedback obsahuje:
          </p>
          <ul style="padding-left: 18px; margin: 0; font-size: 13px; color: var(--text-muted);">
            <li>3 hodnocen√≠ (interesting, learned, enjoyed / 1‚Äì5).</li>
            <li>Libovoln√Ω koment√°≈ô (‚ÄûAny additional comments?‚Äú).</li>
            <li>‚ÄûJe nƒõco, na co byste se chtƒõli p≈ô√≠≈°tƒõ zamƒõ≈ôit?‚Äú ‚Äì konkr√©tn√≠ p≈ô√°n√≠.</li>
            <li>Jm√©no ‚Äì nepovinn√©, lze poslat anonymnƒõ.</li>
            <li>V≈°e se ukl√°d√° do Firestore kolekce <code>Feedback</code>.</li>
          </ul>
        </section>
      </div>

      <!-- Seznam feedback≈Ø -->
      <section class="card">
        <h2 class="card-title">P≈ôijat√© feedbacky</h2>
        <p class="feedback-info" id="feedbackInfo">Naƒç√≠t√°m data z Firebase‚Ä¶</p>

        <div class="feedback-list" id="feedbackList"></div>
      </section>
    </main>
  </div>

  <!-- MODAL: New feedback -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">New feedback</h3>
        <button class="modal-close" id="modalCloseBtn" aria-label="Zav≈ô√≠t">
          <i class="pi pi-times"></i>
        </button>
      </div>

      <div class="form-group">
        <label class="form-label">Did you find it interesting today?</label>
        <div class="rating-row">
          <select id="qInteresting" class="rating-select">
            <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ (5)</option>
            <option value="4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (4)</option>
            <option value="3">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ (3)</option>
            <option value="2">‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ (2)</option>
            <option value="1">‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ (1)</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Did you learn something new today?</label>
        <div class="rating-row">
          <select id="qLearned" class="rating-select">
            <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ (5)</option>
            <option value="4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (4)</option>
            <option value="3">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ (3)</option>
            <option value="2">‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ (2)</option>
            <option value="1">‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ (1)</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Did you enjoy it?</label>
        <div class="rating-row">
          <select id="qEnjoyed" class="rating-select">
            <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ (5)</option>
            <option value="4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (4)</option>
            <option value="3">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ (3)</option>
            <option value="2">‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ (2)</option>
            <option value="1">‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ (1)</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Any additional comments?</label>
        <textarea id="commentGeneral" placeholder="Anything you would like to share‚Ä¶"></textarea>
      </div>

      <div class="form-group">
        <label class="form-label">Je nƒõco, na co byste se chtƒõli p≈ô√≠≈°tƒõ zamƒõ≈ôit?</label>
        <textarea id="commentNextTime" placeholder="Topic, activity, skill you would like to go deeper into next time‚Ä¶"></textarea>
      </div>

      <div class="form-group">
        <label class="form-label">Name</label>
        <input type="text" id="nameInput" placeholder="Your name (optional)">
        <div class="form-helper">
          Optional, you can send your feedback anonymously.
        </div>
      </div>

      <div class="buttons-row">
        <button class="btn-secondary" id="cancelBtn">Cancel</button>
        <button class="btn-primary-wide" id="saveBtn">Save</button>
      </div>

      <div class="status" id="statusMessage"></div>
    </div>
  </div>

  <script>
    /****************************************
     * 1) Firebase inicializace
     ****************************************/
    const firebaseConfig = {
      apiKey: "TV≈ÆJ_API_KEY",
      authDomain: "TV≈ÆJ_AUTH_DOMAIN",
      projectId: "TV≈ÆJ_PROJECT_ID",
      storageBucket: "TV≈ÆJ_STORAGE_BUCKET",
      messagingSenderId: "TV≈ÆJ_SENDER_ID",
      appId: "TV≈ÆJ_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const FEEDBACK_COLLECTION = "Feedback"; // /Feedback

    /****************************************
     * 2) DOM prvky
     ****************************************/
    const todayInfoEl = document.getElementById("todayInfo");
    const feedbackInfoEl = document.getElementById("feedbackInfo");
    const feedbackListEl = document.getElementById("feedbackList");

    const qrImageEl = document.getElementById("qrImage");

    const modalOverlay = document.getElementById("modalOverlay");
    const modalCloseBtn = document.getElementById("modalCloseBtn");
    const openFeedbackBtn = document.getElementById("openFeedbackBtn");
    const cancelBtn = document.getElementById("cancelBtn");
    const saveBtn = document.getElementById("saveBtn");
    const statusMessageEl = document.getElementById("statusMessage");

    const qInterestingEl = document.getElementById("qInteresting");
    const qLearnedEl = document.getElementById("qLearned");
    const qEnjoyedEl = document.getElementById("qEnjoyed");
    const commentGeneralEl = document.getElementById("commentGeneral");
    const commentNextTimeEl = document.getElementById("commentNextTime");
    const nameInputEl = document.getElementById("nameInput");

    /****************************************
     * 3) Zobrazen√≠ dne≈°n√≠ho data
     ****************************************/
    const today = new Date();
    todayInfoEl.textContent =
      "Dnes je: " +
      today.toLocaleDateString("cs-CZ", {
        weekday: "long",
        day: "numeric",
        month: "long",
        year: "numeric"
      });

    /****************************************
     * 4) QR k√≥d: aktu√°ln√≠ URL + ?new=1
     ****************************************/
    (function generateQrCode() {
      const baseUrl = window.location.origin + window.location.pathname;
      const targetUrl = baseUrl + "?new=1";
      const qrApi = "https://api.qrserver.com/v1/create-qr-code/?size=170x170&data=";
      qrImageEl.src = qrApi + encodeURIComponent(targetUrl);
    })();

    /****************************************
     * 5) Modal logika
     ****************************************/
    function resetForm() {
      qInterestingEl.value = "5";
      qLearnedEl.value = "5";
      qEnjoyedEl.value = "5";
      commentGeneralEl.value = "";
      commentNextTimeEl.value = "";
      nameInputEl.value = "";
      statusMessageEl.style.display = "none";
      statusMessageEl.textContent = "";
      statusMessageEl.className = "status";
    }

    function openModal() {
      resetForm();
      modalOverlay.classList.add("open");
    }

    function closeModal() {
      modalOverlay.classList.remove("open");
    }

    openFeedbackBtn.addEventListener("click", openModal);
    modalCloseBtn.addEventListener("click", closeModal);
    cancelBtn.addEventListener("click", closeModal);

    // Kliknut√≠ mimo modal zav≈ôe okno
    modalOverlay.addEventListener("click", (e) => {
      if (e.target === modalOverlay) {
        closeModal();
      }
    });

    // Auto-otev≈ôen√≠ modalu, pokud je v URL ?new=1
    (function autoOpenModalFromUrl() {
      const params = new URLSearchParams(window.location.search);
      if (params.get("new") === "1") {
        openModal();
      }
    })();

    /****************************************
     * 6) Ulo≈æen√≠ feedbacku do Firestore
     ****************************************/
    saveBtn.addEventListener("click", async () => {
      statusMessageEl.style.display = "none";

      const interesting = parseInt(qInterestingEl.value, 10);
      const learned = parseInt(qLearnedEl.value, 10);
      const enjoyed = parseInt(qEnjoyedEl.value, 10);
      const commentGeneral = commentGeneralEl.value.trim();
      const commentNextTime = commentNextTimeEl.value.trim();
      const name = nameInputEl.value.trim();

      if (!interesting || !learned || !enjoyed) {
        statusMessageEl.textContent = "Pros√≠m vypl≈à hodnocen√≠ v≈°ech t≈ô√≠ ot√°zek.";
        statusMessageEl.className = "status error";
        return;
      }

      const feedbackData = {
        interesting,
        learned,
        enjoyed,
        commentGeneral,
        commentNextTime,
        name,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      };

      try {
        saveBtn.disabled = true;
        saveBtn.textContent = "Saving‚Ä¶";

        await db.collection(FEEDBACK_COLLECTION).add(feedbackData);

        statusMessageEl.textContent = "Thanks for your feedback! üôè";
        statusMessageEl.className = "status ok";
        statusMessageEl.style.display = "block";

        setTimeout(() => {
          closeModal();
          saveBtn.disabled = false;
          saveBtn.textContent = "Save";
        }, 800);
      } catch (err) {
        console.error("Error saving feedback:", err);
        statusMessageEl.textContent = "Something went wrong. Please try again.";
        statusMessageEl.className = "status error";
        statusMessageEl.style.display = "block";
        saveBtn.disabled = false;
        saveBtn.textContent = "Save";
      }
    });

    /****************************************
     * 7) Realtime naƒç√≠t√°n√≠ feedback≈Ø z Firestore
     ****************************************/
    db.collection(FEEDBACK_COLLECTION)
      .orderBy("createdAt", "desc")
      .onSnapshot(
        (snapshot) => {
          feedbackListEl.innerHTML = "";

          if (snapshot.empty) {
            feedbackInfoEl.textContent = "Zat√≠m nem√°≈° ≈æ√°dn√Ω feedback.";
            const p = document.createElement("p");
            p.className = "feedback-empty";
            p.textContent = "Jakmile nƒõkdo vypln√≠ formul√°≈ô, uvid√≠≈° ho tady.";
            feedbackListEl.appendChild(p);
            return;
          }

          feedbackInfoEl.textContent =
            "Feedbacky se naƒç√≠taj√≠ ≈æivƒõ z Firebase (kolekce ‚ÄûFeedback‚Äú).";

          snapshot.forEach((doc) => {
            const data = doc.data();
            const card = document.createElement("div");
            card.className = "feedback-card";

            const header = document.createElement("div");
            header.className = "feedback-header";

            const nameEl = document.createElement("div");
            nameEl.className = "feedback-name";
            nameEl.textContent =
              data.name && data.name.trim() !== "" ? data.name : "Anonymous";

            const dateEl = document.createElement("div");
            dateEl.className = "feedback-date";

            if (data.createdAt && data.createdAt.toDate) {
              const d = data.createdAt.toDate();
              dateEl.textContent = d.toLocaleString("cs-CZ", {
                day: "2-digit",
                month: "2-digit",
                year: "numeric",
                hour: "2-digit",
                minute: "2-digit"
              });
            } else {
              dateEl.textContent = "";
            }

            header.appendChild(nameEl);
            header.appendChild(dateEl);
            card.appendChild(header);

            const ratings = document.createElement("div");
            ratings.className = "feedback-ratings";
            ratings.innerHTML = `
              <span>Interesting: ${data.interesting ?? "-"} / 5</span>
              <span>Learned: ${data.learned ?? "-"} / 5</span>
              <span>Enjoyed: ${data.enjoyed ?? "-"} / 5</span>
            `;
            card.appendChild(ratings);

            if (data.commentGeneral && data.commentGeneral.trim() !== "") {
              const label = document.createElement("div");
              label.className = "feedback-section-label";
              label.textContent = "Comment";
              card.appendChild(label);

              const text = document.createElement("p");
              text.className = "feedback-text";
              text.textContent = data.commentGeneral;
              card.appendChild(text);
            }

            if (data.commentNextTime && data.commentNextTime.trim() !== "") {
              const label = document.createElement("div");
              label.className = "feedback-section-label";
              label.textContent = "Next time focus";
              card.appendChild(label);

              const text = document.createElement("p");
              text.className = "feedback-text";
              text.textContent = data.commentNextTime;
              card.appendChild(text);
            }

            feedbackListEl.appendChild(card);
          });
        },
        (error) => {
          console.error("Error loading feedback:", error);
          feedbackInfoEl.textContent =
            "Nepoda≈ôilo se naƒç√≠st data z Firebase. Zkontroluj konfiguraci a Firestore pravidla.";
        }
      );
  </script>
</body>
</html>
``
